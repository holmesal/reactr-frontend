// Generated by CoffeeScript 1.6.2
(function() {
  define(['jquery', 'underscore', 'backbone', 'handlebars', 'build/models/controls/switch', 'text!templates/control.html', 'build/views/editControlView'], function($, _, Backbone, Handlebars, SwitchModel, ControlTemplate, EditControlView) {
    var ControlView;

    ControlView = Backbone.View.extend({
      tagName: 'div',
      className: 'control',
      template: Handlebars.compile(ControlTemplate),
      events: {
        'click': 'clickEvent'
      },
      initialize: function($dropped) {
        console.log($dropped.hasClass('control-switch'));
        if ($dropped.hasClass('control-switch')) {
          this.model = new SwitchModel;
          this.controlClass = 'control-switch';
        }
        this.render();
        this.$el.insertAfter($dropped);
        $dropped.remove();
        this.focusOn();
        window.app.views.editControlView = new EditControlView({
          model: this.model
        });
        return this.listenTo(this.model, 'change', this.render);
      },
      render: function() {
        this.$el.html(this.template(this.model.toJSON()));
        this.$el.addClass(this.controlClass);
        return this.$el.addClass('backbone');
      },
      focusOn: function() {
        this.$el.animate({
          opacity: 1
        });
        return $('.control').not(this.$el).animate({
          opacity: 0.4
        }, 300);
      },
      clickEvent: function(e) {
        if (!$(e.currentTarget).hasClass('ui-sortable-helper')) {
          if (window.app.views.editControlView) {
            window.app.views.editControlView.undelegateEvents();
          }
          this.focusOn();
          return window.app.views.editControlView = new EditControlView({
            model: this.model
          });
        }
      }
    });
    return ControlView;
  });

}).call(this);
